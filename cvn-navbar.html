<link rel="import" href="../polymer/polymer-element.html">
<link rel="import" href="cvn-navbar-menu-item.html">
<link rel="import" href="cvn-navbar-dropdown-item.html">
<link rel="import" href="cvn-navbar-styles.html">

<dom-module id="cvn-navbar">
  <template>
    <style include="cvn-navbar-styles">
      :host {
        display: block;
        font-family: var(--navbar-font-family);
      }

      #cvnNavbar {
        box-sizing: border-box;
        background-color: var(--navbar-bgcolor);
        height: var(--navbar-height);
        width: 100%;
        position: var(--navbar-position);
        top: 0;
        left: 0;
      }

      #cvnNavbar .cvn-navbar-items {
        height: 100%;
        justify-content: var(--navbar-justify-content);
        align-items: center;
      }

      #cvnNavbar .cvn-navbar-collapse-menu-outer {
        height: 100%;
        display: none;
        justify-content: flex-end;
        align-items: center;
      }

      #cvnNavbar .cvn-navbar-collapse-menu {
        margin-right: 20px;
        cursor: pointer;
      }

      #cvnNavbar .cvn-navbar-collapse-menu > div {
        display: block;
        border-radius: 8px;
        background-color: var(--navbar-collapse-menu-color);
        width: 20px;
        padding: 2px;
        margin-bottom: 4px;
      }

      #cvnNavbar .cvn-navbar-collapse-menu:hover > div {
        background-color: #635394;
      }

      #cvnNavbar .cvn-navbar-collapse-menu > div:last-child {
        margin-bottom: 0;
      }
      
      @media only screen and (max-width: 768px) {
        #cvnNavbar .cvn-navbar-items {
          display: none;
        }

        #cvnNavbar .cvn-navbar-collapse-menu-outer {
          display: flex;
        }
      }

      @media only screen and (min-width: 769px) {
        #cvnNavbar .cvn-navbar-items {
          display: flex;
        }

        #cvnNavbar .cvn-navbar-collapse-menu-outer {
          display: none;
        }
      }
    </style>
    <nav id="cvnNavbar" class="cvn-navbar">
      <div id="cvnNavbarItems" class="cvn-navbar-items"></div>
      <div class="cvn-navbar-collapse-menu-outer">
          <div id="cvnNavbarCollapseMenu" class="cvn-navbar-collapse-menu">
            <div></div>
            <div></div>
            <div></div>
          </div>
      </div>

    </nav>
  </template>

  <script>
    class CvnNavbar extends Polymer.Element {
      static get is() { return "cvn-navbar"; }
      static get properties() {
        return {
          data: {
            type: Array,
            value: function() {
              return [];
            },
            observer: "_dataObserver"
          }
        };
      }

      constructor() {
        super();
      }

      ready() {
          super.ready();
      }

      _dataObserver(newValue, oldValue) {
        if(newValue) {
          this._generateMenu(newValue);
        }
      }

      _generateMenu(data) {
        if (data && data.length) {
          for (let i = 0; i < data.length; i++) {
            let menuItem = this._generateMenuItems(data[i]);
            
            this.$.cvnNavbarItems.appendChild(menuItem);
          }
          
        }
      }

      _generateMenuItems(item) {
        let menuItem = null;

        if (item.type === "single") {
          menuItem = document.createElement("cvn-navbar-menu-item");
        } else if (item.type === "dropdown") {
          menuItem = document.createElement("cvn-navbar-dropdown-item");
          menuItem.setAttribute("data", JSON.stringify(item.sub));
        }

        menuItem.innerText = item.name;
        menuItem.setAttribute("link", item.link);
        return menuItem;
      }
    }

    window.customElements.define(CvnNavbar.is, CvnNavbar);
  </script>
</dom-module>
